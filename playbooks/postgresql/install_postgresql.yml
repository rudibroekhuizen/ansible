---
- name: Install postgres
  hosts: postgresql
  tasks:
    - name: Adding APT repository key
      become: true
      when: ansible_os_family == 'Debian'
      apt_key:
        id: ACCC4CF8
        url: https://www.postgresql.org/media/keys/ACCC4CF8.asc

    - name: Add postgres official APT repository
      become: true
      when: ansible_os_family == 'Debian'
      apt_repository:
        repo: "deb http://apt.postgresql.org/pub/repos/apt/ {{ansible_distribution_release}}-pgdg main"

    - name: Install postgres
      become: true
      when: ansible_os_family == 'Debian'
      apt:
        name: "postgresql-{{postgresql_version}}"
        state: present
        update_cache: yes
        cache_valid_time: 3600

    - name: Install dependencies for the Ansible postgres modules
      become: true
      when: ansible_os_family == 'Debian'
      apt:
        name: "{{ packages }}"
      vars:
        packages:
          - python-psycopg2
          - python3-psycopg2
...
